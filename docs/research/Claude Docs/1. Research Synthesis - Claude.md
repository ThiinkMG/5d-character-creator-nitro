# 5D Character Creator: Research Synthesis & Development Roadmap

## Executive Summary

Based on comprehensive research from Gemini (storyteller pain points, competitive landscape) and Cursor (technical implementation patterns), this document synthesizes findings into an actionable development plan.

### Core Insight
> **The gap between "AI chat tools" and "narrative management systems" is the market opportunity.** Current AI platforms offer conversational flow; storytellers need structural consistency. The 5D Character Creator is positioned to bridge this gap by evolving from "brainstorming assistant" to "canonical narrative database."

### Top 3 Strategic Priorities
1. **Canonical Context Manager** â€” Prevent AI amnesia with persistent, validated lore
2. **Relationship & Hierarchy Visualization** â€” Transform linear data into navigable knowledge graphs
3. **Project Completion Tools** â€” Help creators finish, not just start (the underserved need)

---

## Research Synthesis Matrix

| Domain | Gemini Finding | Cursor Finding | Synthesized Action |
|--------|---------------|----------------|-------------------|
| **Memory** | "Context Amnesia" is #1 complaint; need database precision | SCORE framework: 23.6% higher coherence with dynamic state tracking | Implement Canonical Knowledge Graph with pre/post validation |
| **Structure** | Creators need "Wiki" not "Chat log"; hierarchical worldbuilding | Parent-child relationships with auto-context inclusion (Novelcrafter pattern) | Add explicit entity hierarchy: World â†’ Region â†’ Location â†’ Character |
| **Consistency** | "Continuity Editor" is most-requested tool | Semantic validation via NER/POS tagging; Context Transfer Protocol (CTP) | Build continuity checker with canonical fact validation |
| **Voice** | Voice preservation is major friction; AI defaults to generic | Voice fingerprinting system with consistency checking | Add Voice Profile schema + Voice Match mode |
| **Visualization** | Linear chat vs. branching lore mismatch | Visual relationship graphs, family trees, timeline canvas | Implement relationship graph + timeline visualization |
| **Completion** | Creators abandon projects; need "finishing" not "starting" tools | Gap analysis, completion checklists, "Finishing Mode" | Add Project Completion Dashboard + Export Prep mode |
| **Privacy** | Strong demand for local/offline (Obsidian model) | Hybrid structured/unstructured data model | Consider local-first architecture for sensitive projects |

---

## Technical Architecture: Canonical Context Manager

### Current Flow
```
User selects entity â†’ Full context dumped â†’ AI generates â†’ JSON save block â†’ Manual apply
```

### Enhanced Flow (Proposed)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CANONICAL CONTEXT MANAGER                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  User    â”‚â”€â”€â”€â–¶â”‚   Mode       â”‚â”€â”€â”€â–¶â”‚   Smart      â”‚â”€â”€â”€â–¶â”‚     AI       â”‚  â”‚
â”‚  â”‚  Input   â”‚    â”‚   Detection  â”‚    â”‚   Context    â”‚    â”‚   Provider   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   Injection  â”‚    â”‚   Router     â”‚  â”‚
â”‚                         â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â–¼                   â”‚                    â”‚         â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚                    â–¼         â”‚
â”‚                  â”‚  Context     â”‚           â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                  â”‚  Rules       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚   Response   â”‚  â”‚
â”‚                  â”‚  Engine      â”‚                        â”‚   Generated  â”‚  â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚                                       â”‚          â”‚
â”‚                         â–¼                                       â–¼          â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                  â”‚  Canonical   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  Continuity  â”‚   â”‚
â”‚                  â”‚  Knowledge   â”‚                       â”‚  Validator   â”‚   â”‚
â”‚                  â”‚  Graph       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚              â”‚   â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â”‚                                       â”‚          â”‚
â”‚                         â–¼                                       â–¼          â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                  â”‚  Entity      â”‚                       â”‚  Flagged     â”‚   â”‚
â”‚                  â”‚  Registry    â”‚                       â”‚  Conflicts   â”‚   â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                â”‚           â”‚
â”‚                                                                â–¼           â”‚
â”‚                                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                                                         â”‚  User Review â”‚   â”‚
â”‚                                                         â”‚  & Apply     â”‚   â”‚
â”‚                                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Component Specifications

#### 1. Smart Context Injection Rules

```typescript
interface ContextInjectionConfig {
  mode: ChatMode;
  entityType: 'character' | 'world' | 'project';
  includeFields: string[];
  excludeFields: string[];
  maxTokens: number;
  priorityOrder: string[];
}

const CONTEXT_RULES: Record<ChatMode, ContextInjectionConfig> = {
  'chat_with_character': {
    mode: 'chat_with_character',
    entityType: 'character',
    includeFields: ['voiceProfile', 'personality', 'currentRelationships', 'recentEvents'],
    excludeFields: ['detailedBackstory', 'arcResolution', 'metaNotes'],
    maxTokens: 2000,
    priorityOrder: ['voiceProfile', 'personality', 'currentState', 'relationships']
  },
  'workshop_analyze': {
    mode: 'workshop_analyze',
    entityType: 'character',
    includeFields: ['full5DProfile', 'canonicalFacts', 'timeline', 'relationships'],
    excludeFields: ['voiceProfile'],
    maxTokens: 4000,
    priorityOrder: ['canonicalFacts', 'arc', 'backstory', 'personality', 'foundation']
  },
  'worldbuilding': {
    mode: 'worldbuilding',
    entityType: 'world',
    includeFields: ['lore', 'geography', 'factions', 'magicSystem', 'toneGenre'],
    excludeFields: ['individualCharacterArcs'],
    maxTokens: 3000,
    priorityOrder: ['toneGenre', 'magicSystem', 'factions', 'geography', 'history']
  },
  'continuity_check': {
    mode: 'continuity_check',
    entityType: 'character',
    includeFields: ['canonicalFacts', 'timeline', 'establishedDetails'],
    excludeFields: ['speculativeContent', 'draftNotes'],
    maxTokens: 5000,
    priorityOrder: ['canonicalFacts', 'timeline', 'physicalDescription', 'relationships']
  },
  'voice_match': {
    mode: 'voice_match',
    entityType: 'character',
    includeFields: ['voiceProfile', 'sampleDialogue', 'personality', 'speechPatterns'],
    excludeFields: ['backstory', 'arc', 'relationships'],
    maxTokens: 1500,
    priorityOrder: ['voiceProfile', 'sampleDialogue', 'personality']
  }
};
```

#### 2. Enhanced Entity Schema

```typescript
// Character5D Enhanced Schema
interface Character5D {
  id: string;
  projectId: string;
  worldId?: string;
  
  // ===== FOUNDATION (0-20%) =====
  foundation: {
    name: string;
    aliases: string[];
    role: 'protagonist' | 'antagonist' | 'supporting' | 'npc' | 'custom';
    archetype: string;
    concept: string; // One-line pitch
    premise: string; // Extended concept
  };
  
  // ===== PERSONALITY (20-40%) =====
  personality: {
    coreTraits: string[];
    flaws: string[];
    fears: string[];
    desires: string[];
    values: string[];
    quirks: string[];
    mbtiType?: string;
    enneagramType?: string;
    internalConflict: string;
  };
  
  // ===== VOICE PROFILE (NEW) =====
  voiceProfile: {
    sampleDialogue: string[]; // 3-5 representative lines
    speechPatterns: string[]; // e.g., "uses rhetorical questions", "speaks in fragments"
    vocabularyLevel: 'simple' | 'moderate' | 'complex' | 'archaic';
    tone: string; // e.g., "sardonic", "earnest", "formal"
    dialect?: string;
    catchphrases?: string[];
    avoids?: string[]; // Words/phrases they'd never say
  };
  
  // ===== BACKSTORY (40-60%) =====
  backstory: {
    origin: string;
    ghost: string; // Past wound/trauma
    ghostImpact: string; // How it affects present behavior
    formativeEvents: {
      event: string;
      age?: number;
      impact: string;
    }[];
    timeline: {
      date: string;
      event: string;
      significance: 'minor' | 'major' | 'pivotal';
    }[];
  };
  
  // ===== RELATIONSHIPS (60-80%) =====
  relationships: {
    targetId: string;
    targetName: string; // Denormalized for display
    type: 'ally' | 'enemy' | 'family' | 'romantic' | 'mentor' | 'mentee' | 'rival' | 'neutral' | 'complicated';
    subtype?: string; // e.g., "sibling", "ex-lover", "business partner"
    description: string;
    dynamicTension: number; // 0-100 (how volatile)
    history: string;
    currentState: 'stable' | 'evolving' | 'deteriorating' | 'broken';
  }[];
  
  // ===== ARC (80-100%) =====
  arc: {
    arcType: 'positive' | 'negative' | 'flat' | 'corruption' | 'redemption';
    want: string; // External goal
    need: string; // Internal need
    lie: string; // False belief
    truth: string; // Truth they must learn
    climax: string;
    resolution: string;
    transformationSummary: string;
  };
  
  // ===== CANONICAL FACTS (NEW - for continuity checking) =====
  canonicalFacts: {
    id: string;
    category: 'physical' | 'personality' | 'history' | 'relationship' | 'ability' | 'possession' | 'other';
    fact: string;
    establishedIn: string; // Scene/chapter/session reference
    establishedAt: Date;
    confidence: 'definite' | 'implied' | 'tentative';
  }[];
  
  // ===== METADATA =====
  meta: {
    completionPercentage: number;
    completionByDimension: {
      foundation: number;
      personality: number;
      backstory: number;
      relationships: number;
      arc: number;
    };
    createdAt: Date;
    updatedAt: Date;
    lastAIInteraction: Date;
    tags: string[];
    notes: string;
  };
  
  // ===== MEDIA =====
  media: {
    avatar?: string;
    gallery: string[];
    voiceSample?: string; // Audio reference URL
  };
}

// World Schema
interface World {
  id: string;
  projectId: string;
  
  // Core
  name: string;
  genre: string[];
  tone: string[];
  logline: string;
  
  // Systems
  magicSystem?: {
    name: string;
    rules: string[];
    limitations: string[];
    cost: string;
  };
  technologyLevel: string;
  
  // Geography (hierarchical)
  locations: {
    id: string;
    name: string;
    type: 'continent' | 'nation' | 'region' | 'city' | 'district' | 'building' | 'landmark';
    parentId?: string; // For hierarchy
    description: string;
    significance: string;
    linkedCharacters: string[];
  }[];
  
  // Factions
  factions: {
    id: string;
    name: string;
    type: string;
    goals: string[];
    values: string[];
    enemies: string[];
    allies: string[];
    linkedCharacters: string[];
  }[];
  
  // History
  history: {
    era: string;
    events: {
      date: string;
      event: string;
      impact: string;
    }[];
  }[];
  
  // Canonical Lore
  canonicalLore: {
    id: string;
    category: string;
    fact: string;
    source: string;
  }[];
  
  meta: {
    createdAt: Date;
    updatedAt: Date;
    tags: string[];
  };
}

// Project Schema (container)
interface Project {
  id: string;
  name: string;
  type: 'novel' | 'screenplay' | 'game' | 'ttrpg' | 'series' | 'other';
  
  // Linked entities
  worldIds: string[];
  characterIds: string[];
  
  // Completion tracking
  completion: {
    overall: number;
    characters: number;
    worlds: number;
    outline: number;
    draft: number;
  };
  
  // Narrative structure (optional)
  structure?: {
    acts: {
      name: string;
      chapters: {
        name: string;
        scenes: {
          name: string;
          characters: string[];
          location: string;
          summary: string;
          status: 'outline' | 'draft' | 'revised' | 'final';
        }[];
      }[];
    }[];
  };
  
  meta: {
    createdAt: Date;
    updatedAt: Date;
    tags: string[];
  };
}
```

#### 3. Multi-Provider AI Router

```typescript
interface AIRouterConfig {
  taskType: TaskType;
  primaryProvider: AIProvider;
  fallbackProvider: AIProvider;
  modelConfig: {
    temperature: number;
    maxTokens: number;
  };
  rationale: string;
}

type TaskType = 
  | 'brainstorm' 
  | 'dialogue' 
  | 'analysis' 
  | 'structured_data' 
  | 'continuity_check'
  | 'voice_match'
  | 'worldbuilding'
  | 'image_generation';

type AIProvider = 'claude-3.5-sonnet' | 'gpt-4' | 'gpt-4-turbo' | 'gemini-2.0-flash' | 'dalle-3' | 'gemini-imagen';

const AI_ROUTER: Record<TaskType, AIRouterConfig> = {
  brainstorm: {
    taskType: 'brainstorm',
    primaryProvider: 'gemini-2.0-flash',
    fallbackProvider: 'gpt-4-turbo',
    modelConfig: { temperature: 0.9, maxTokens: 2000 },
    rationale: 'Gemini excels at fast, creative divergent thinking'
  },
  dialogue: {
    taskType: 'dialogue',
    primaryProvider: 'claude-3.5-sonnet',
    fallbackProvider: 'gpt-4',
    modelConfig: { temperature: 0.7, maxTokens: 1500 },
    rationale: 'Claude produces more natural, nuanced dialogue'
  },
  analysis: {
    taskType: 'analysis',
    primaryProvider: 'claude-3.5-sonnet',
    fallbackProvider: 'gpt-4',
    modelConfig: { temperature: 0.3, maxTokens: 3000 },
    rationale: 'Claude handles complex analytical comparisons well'
  },
  structured_data: {
    taskType: 'structured_data',
    primaryProvider: 'gpt-4',
    fallbackProvider: 'claude-3.5-sonnet',
    modelConfig: { temperature: 0.2, maxTokens: 2000 },
    rationale: 'GPT-4 most reliable for consistent JSON/structured output'
  },
  continuity_check: {
    taskType: 'continuity_check',
    primaryProvider: 'claude-3.5-sonnet',
    fallbackProvider: 'gpt-4',
    modelConfig: { temperature: 0.1, maxTokens: 4000 },
    rationale: 'Claude excels at careful comparison and validation'
  },
  voice_match: {
    taskType: 'voice_match',
    primaryProvider: 'claude-3.5-sonnet',
    fallbackProvider: 'gpt-4',
    modelConfig: { temperature: 0.6, maxTokens: 1500 },
    rationale: 'Claude best at mimicking specific writing styles'
  },
  worldbuilding: {
    taskType: 'worldbuilding',
    primaryProvider: 'claude-3.5-sonnet',
    fallbackProvider: 'gemini-2.0-flash',
    modelConfig: { temperature: 0.7, maxTokens: 3000 },
    rationale: 'Claude handles complex interconnected lore well'
  },
  image_generation: {
    taskType: 'image_generation',
    primaryProvider: 'dalle-3',
    fallbackProvider: 'gemini-imagen',
    modelConfig: { temperature: 0, maxTokens: 0 },
    rationale: 'DALL-E 3 for quality, Gemini for speed/cost'
  }
};
```

---

## New Chat Modes Specification

### Mode 1: ğŸ” Continuity Checker

**Purpose:** Validate new content against established canonical facts

**User Flow:**
1. User pastes draft text or selects scene
2. System loads all relevant canonical facts for linked entities
3. AI analyzes for contradictions, timeline issues, forgotten details
4. Results displayed as inline annotations + summary panel

**UI Concept:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“„ Draft Text                    â”‚  ğŸ“‹ Continuity Report       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                   â”‚                             â”‚
â”‚  "Kira drew her sword with her    â”‚  âš ï¸ CONFLICTS FOUND: 2      â”‚
â”‚   [right hand]Â¹, her [blue eyes]Â² â”‚                             â”‚
â”‚   flashing with anger..."         â”‚  1. Hand contradiction      â”‚
â”‚                                   â”‚     â”œâ”€ Draft: "right hand"  â”‚
â”‚                                   â”‚     â””â”€ Canon: "left-handed" â”‚
â”‚                                   â”‚        (Ch.3, established)  â”‚
â”‚                                   â”‚                             â”‚
â”‚                                   â”‚  2. Eye color mismatch      â”‚
â”‚                                   â”‚     â”œâ”€ Draft: "blue eyes"   â”‚
â”‚                                   â”‚     â””â”€ Canon: "green eyes"  â”‚
â”‚                                   â”‚        (Profile, definite)  â”‚
â”‚                                   â”‚                             â”‚
â”‚                                   â”‚  âœ… CONSISTENT: 12 facts    â”‚
â”‚                                   â”‚                             â”‚
â”‚                                   â”‚  [Fix All] [Ignore] [Edit]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Prompt Template:**
```
You are a continuity editor. Analyze the following draft text against the established canonical facts.

CANONICAL FACTS:
{{canonicalFacts}}

DRAFT TEXT:
{{draftText}}

For each potential contradiction:
1. Quote the exact conflicting text from the draft
2. State the canonical fact it conflicts with
3. Rate severity: DEFINITE_CONFLICT | POSSIBLE_CONFLICT | STYLE_INCONSISTENCY
4. Suggest a fix

Return as JSON:
{
  "conflicts": [...],
  "consistentFacts": [...],
  "suggestions": [...]
}
```

---

### Mode 2: ğŸ­ Voice Match

**Purpose:** Generate dialogue/narration in a specific character's voice

**User Flow:**
1. User selects character
2. Voice Profile displayed in sidebar for reference
3. User provides prompt (e.g., "Write Kira's reaction to betrayal")
4. AI generates in character's voice
5. Optional: "Voice Consistency Score" shown

**UI Concept:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Voice Match: Kira                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ¤ Voice Profile          â”‚  ğŸ’¬ Generation                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  Tone: Sardonic, guarded   â”‚  Prompt: "Kira discovers Marcus    â”‚
â”‚  Vocabulary: Moderate      â”‚  betrayed her. Write her reaction."â”‚
â”‚  Patterns:                 â”‚                                    â”‚
â”‚  â€¢ Uses rhetorical Qs      â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  â€¢ Short, clipped sentencesâ”‚                                    â”‚
â”‚  â€¢ Rarely shows vulnerability                                   â”‚
â”‚                            â”‚  "Of course. Of course he did."    â”‚
â”‚  Sample Dialogue:          â”‚  She laughedâ€”a brittle sound that  â”‚
â”‚  "You think I care? That's â”‚  cut through the silence. "Did you â”‚
â”‚   adorable."               â”‚  really think I'd be surprised?"   â”‚
â”‚  "Save the speech."        â”‚                                    â”‚
â”‚                            â”‚  Her hand found the sword hilt.    â”‚
â”‚  Avoids:                   â”‚  Not to drawâ€”not yet. Just to      â”‚
â”‚  â€¢ Emotional declarations  â”‚  feel something solid.             â”‚
â”‚  â€¢ Flowery language        â”‚                                    â”‚
â”‚                            â”‚  Voice Score: 94% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘   â”‚
â”‚                            â”‚                                    â”‚
â”‚                            â”‚  [Regenerate] [Edit] [Save to Arc] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Mode 3: ğŸ² GM's Toolkit

**Purpose:** Generate game-ready content for TTRPG creators

**Sub-modes:**

**A. Random Tables**
- Loot generators (by tier/theme)
- Name generators (by culture/species)
- Encounter generators (by environment/difficulty)
- Plot hook generators

**B. Stat Block Generator**
- System selector: D&D 5e, Pathfinder 2e, Custom
- Input: Character profile or concept
- Output: Properly formatted stat block

**C. Encounter Builder**
- Party level/size input
- Difficulty selector
- Terrain/environment
- Output: Balanced encounter with tactics

**UI Concept:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ² GM's Toolkit                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [Random Tables] [Stat Blocks] [Encounters] [Session Prep]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  STAT BLOCK GENERATOR                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                            â”‚
â”‚  Character: Kira Shadowbane                                     â”‚
â”‚  System: D&D 5e                                                 â”‚
â”‚  CR Target: 5                                                   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ KIRA SHADOWBANE                                         â”‚   â”‚
â”‚  â”‚ Medium humanoid (human), chaotic neutral                â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚
â”‚  â”‚ Armor Class 16 (studded leather)                        â”‚   â”‚
â”‚  â”‚ Hit Points 65 (10d8 + 20)                               â”‚   â”‚
â”‚  â”‚ Speed 30 ft.                                            â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚
â”‚  â”‚ STR  DEX  CON  INT  WIS  CHA                           â”‚   â”‚
â”‚  â”‚  12  18   14   13   11   15                            â”‚   â”‚
â”‚  â”‚ (+1)(+4) (+2) (+1) (+0) (+2)                           â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚
â”‚  â”‚ Skills: Stealth +7, Deception +5, Perception +3        â”‚   â”‚
â”‚  â”‚ Senses: passive Perception 13                          â”‚   â”‚
â”‚  â”‚ Languages: Common, Thieves' Cant                       â”‚   â”‚
â”‚  â”‚ Challenge: 5 (1,800 XP)                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  [Copy as Markdown] [Copy as Homebrewery] [Save to Character]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Mode 4: ğŸ“Š Arc Analyzer

**Purpose:** Evaluate character arcs against narrative frameworks

**Frameworks Supported:**
- Save the Cat (15 beats)
- Hero's Journey (12 stages)
- Truby's 22 Steps
- Dan Harmon's Story Circle
- Three-Act Structure

**Output:**
- Visual arc map showing where character currently falls
- Gap analysis: "Missing: Midpoint reversal, All Is Lost moment"
- Suggestions for strengthening weak points

---

### Mode 5: âœ… Completion Assistant (NEW - based on Cursor findings)

**Purpose:** Help creators finish projects, not just start them

**Features:**
- **Gap Analysis:** "Your character is 73% complete. Missing: Ghost impact, Arc resolution"
- **Completion Checklist:** Dynamic checklist based on project type (novel vs. TTRPG)
- **Finishing Prompts:** AI-guided questions to fill gaps
- **Export Readiness:** "Your character is ready for export" / "Needs: 3 more items"

**UI Concept:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… Completion Assistant: Project "The Hollow Crown"            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  PROJECT COMPLETION: 67% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘               â”‚
â”‚                                                                 â”‚
â”‚  CHARACTERS          WORLDS           OUTLINE                   â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 78%      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 54%   â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘ 42%           â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                 â”‚
â”‚  ğŸ”´ BLOCKING GAPS (finish these first):                         â”‚
â”‚  â”œâ”€ Kira: Missing "Ghost Impact" (how trauma affects behavior)  â”‚
â”‚  â”œâ”€ World: Magic system has no defined limitations              â”‚
â”‚  â””â”€ Outline: Act 2 has no midpoint reversal                     â”‚
â”‚                                                                 â”‚
â”‚  ğŸŸ¡ RECOMMENDED NEXT:                                            â”‚
â”‚  â”œâ”€ Marcus: Relationship with Kira undefined                    â”‚
â”‚  â”œâ”€ World: Add 2+ factions for conflict                         â”‚
â”‚  â””â”€ Kira: Arc resolution is vague                               â”‚
â”‚                                                                 â”‚
â”‚  ğŸŸ¢ COMPLETE:                                                    â”‚
â”‚  â”œâ”€ Kira: Foundation, Personality, Backstory                    â”‚
â”‚  â”œâ”€ World: Genre, Tone, Core Lore                               â”‚
â”‚  â””â”€ 12 canonical facts established                              â”‚
â”‚                                                                 â”‚
â”‚  [Work on Gaps] [Generate Checklist] [Export Report]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Prioritized Development Roadmap

### Phase 1: Foundation Enhancements (2-3 Weeks)
**Goal:** Strengthen existing architecture for future features

| Task | Effort | Impact | Priority |
|------|--------|--------|----------|
| Add `voiceProfile` to Character schema | S | High | P0 |
| Add `canonicalFacts` array to entities | S | High | P0 |
| Implement relationship type selector | S | Medium | P1 |
| Add completion tracking per dimension | S | Medium | P1 |
| Settings: Default AI provider per mode | S | Medium | P1 |
| "Copy as Markdown" export | S | Medium | P2 |

**Deliverables:**
- Updated Zustand store with new schema fields
- UI for voice profile editing
- Basic canonical fact logging

---

### Phase 2: Smart Context System (4-6 Weeks)
**Goal:** Implement intelligent context injection

| Task | Effort | Impact | Priority |
|------|--------|--------|----------|
| Context injection rules engine | M | High | P0 |
| Mode-aware context selection | M | High | P0 |
| Multi-provider router (basic) | M | High | P0 |
| Token budget management | S | Medium | P1 |
| Context preview UI ("What AI sees") | M | Medium | P1 |

**Deliverables:**
- Working context injection for all existing modes
- Provider selection based on task type
- Debug panel showing injected context

---

### Phase 3: Continuity & Voice (6-8 Weeks)
**Goal:** Core differentiation features

| Task | Effort | Impact | Priority |
|------|--------|--------|----------|
| Continuity Checker mode | L | High | P0 |
| Basic contradiction detection | M | High | P0 |
| Voice Match mode | M | High | P0 |
| Voice consistency scoring | M | Medium | P1 |
| Inline annotation UI | M | Medium | P1 |

**Deliverables:**
- Working Continuity Checker with conflict flagging
- Voice Match mode with style enforcement
- Side-panel annotation interface

---

### Phase 4: Visualization & Completion (8-12 Weeks)
**Goal:** Polish and differentiation

| Task | Effort | Impact | Priority |
|------|--------|--------|----------|
| Relationship graph visualization | L | High | P0 |
| Completion Assistant mode | M | High | P0 |
| Gap analysis engine | M | High | P0 |
| Timeline visualization | L | Medium | P1 |
| Arc Analyzer mode | M | Medium | P1 |
| GM's Toolkit (basic) | M | Medium | P2 |

**Deliverables:**
- Interactive relationship graph (D3.js or similar)
- Project completion dashboard
- Exportable completion reports

---

### Phase 5: Advanced Features (Future)
**Goal:** Market leadership

| Feature | Description |
|---------|-------------|
| Narrative Branch System | Alternate timelines, "what if" scenarios |
| Collaborative Editing | Multi-user with conflict resolution |
| Local-First Mode | Offline capability, privacy-focused |
| Plugin System | Custom frameworks, game system templates |
| AI Memory Persistence | Cross-session character "memory" |

---

## Competitive Positioning Statement

> **5D Character Creator is the first narrative tool that treats AI as a "canonical memory" rather than a "chat partner."** While competitors offer either AI writing assistance (Sudowrite) OR database management (World Anvil), 5D uniquely bridges bothâ€”ensuring AI-generated content is always validated against user-defined truth. For creators tired of AI that "forgets" after 20,000 words, 5D offers structural consistency without sacrificing creative flow.

### Key Differentiators

| Competitor | Their Strength | 5D's Counter |
|------------|---------------|--------------|
| Novelcrafter | Codex + context injection | We add continuity validation + voice matching |
| Sudowrite | AI writing with "Story Bible" | We add hierarchical worldbuilding + TTRPG support |
| World Anvil | Deep worldbuilding database | We add AI integration + completion tracking |
| Campfire Pro | Relationship visualization | We add AI-powered gap analysis + finishing tools |

### Underserved Markets to Target
1. **TTRPG Game Masters** â€” Need quick, reliable content generation without hallucinations
2. **Series Writers** â€” Need cross-book continuity management
3. **Worldbuilders** â€” Need AI that respects their established lore

---

## Next Steps

### Immediate (This Week)
1. [ ] Review and approve schema changes
2. [ ] Create GitHub issues for Phase 1 tasks
3. [ ] Design Figma mockups for Voice Profile UI

### Short-Term (Next 2 Weeks)
1. [ ] Implement voiceProfile and canonicalFacts in Zustand store
2. [ ] Build relationship type selector component
3. [ ] Create context injection rules engine (prototype)

### Medium-Term (Next Month)
1. [ ] Complete Phase 1 deliverables
2. [ ] Begin Phase 2: Smart Context System
3. [ ] User testing for new schema fields

---

## Deep Dive: Implementation Patterns from Industry Leaders

### The "Composite Workflow" Standard

The industry is moving away from "AI Chatbots" toward **"AI-Augmented Word Processors."** The winning formula is:

> **Visual Wiki (UI)** + **Vector Search (Architecture)** + **Just-in-Time Injection (Workflow)**

### Competitive Implementation Matrix

| Tool | Core Philosophy | Context Injection Method | Entity System |
|------|----------------|-------------------------|---------------|
| **Novelcrafter** | "The Codex" | **Explicit Tagging & Smart Retrieval.** `@mention` characters to inject bios; "Global" entries always present | **Relational.** Types (Character, Location, Object) with defined relationships |
| **Sudowrite** | "The Cascade" | **Field-Based Flow.** Data flows downstream from Story Bible â†’ Outline â†’ Chapter | **Bucket-Based.** Fixed categories the AI scans before generating |
| **LegendKeeper** | "The Atlas" | **Visual & Spatial.** Auto-linking detected entities to wiki entries | **Nested Hierarchy.** Infinite nesting (Universe â†’ Planet â†’ City â†’ Tavern) |
| **Campfire** | "The Module" | **Modular Activation.** Toggle modules active/inactive per session | **Panel-Based.** Data as visual widgets on canvas |

### Critical Pattern: "Just-in-Time" Context Injection

**Key Finding:** The most successful pattern is **"Just-in-Time" Context Injection**. Instead of dumping the whole Bible into the AI (which confuses it), these tools:

1. Scan the current scene for keywords (e.g., "Sword of Omens")
2. Retrieve only that specific entry from the database
3. Inject it into the hidden "System Prompt" before generation

This prevents context overflow and maintains relevance.

---

### Architecture: The "Writer vs. Historian" Model

Instead of asking one LLM to be creative *and* factually consistent, split the workload:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    "WRITER VS. HISTORIAN" ARCHITECTURE                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚  â”‚   USER'S DRAFT   â”‚                                                       â”‚
â”‚  â”‚  (Last 1000 words)â”‚                                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚           â”‚                                                                 â”‚
â”‚           â–¼                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  â”‚  ENTITY SCANNER  â”‚â”€â”€â”€â”€â–¶â”‚  VECTOR DATABASE â”‚                             â”‚
â”‚  â”‚  (Identifies:    â”‚     â”‚  (World Bible)   â”‚                             â”‚
â”‚  â”‚   "Alice", "Bob",â”‚     â”‚  - Characters    â”‚                             â”‚
â”‚  â”‚   "Northern War")â”‚     â”‚  - Locations     â”‚                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  - Lore          â”‚                             â”‚
â”‚           â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚           â”‚                        â”‚                                        â”‚
â”‚           â–¼                        â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚           CONTEXT ASSEMBLER                  â”‚                           â”‚
â”‚  â”‚  Constructs hidden prompt:                   â”‚                           â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚                           â”‚
â”‚  â”‚  â”‚ Background: [Alice's sheet, Bob's sheet]â”‚â”‚                           â”‚
â”‚  â”‚  â”‚ Scene Goal: [Beat from outline]         â”‚â”‚                           â”‚
â”‚  â”‚  â”‚ Recent Events: [Ch.4 summary]           â”‚â”‚                           â”‚
â”‚  â”‚  â”‚ Task: Write next 500 words              â”‚â”‚                           â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                       â”‚                                                     â”‚
â”‚                       â–¼                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚                    WRITER AGENT                           â”‚              â”‚
â”‚  â”‚              (Creative generation)                        â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                       â”‚                                                     â”‚
â”‚                       â–¼                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚                   CRITIC AGENT                            â”‚              â”‚
â”‚  â”‚  "Does this contradict the Canon?"                        â”‚              â”‚
â”‚  â”‚  â”œâ”€ Writer says: "Alice's blue eyes"                      â”‚              â”‚
â”‚  â”‚  â”œâ”€ Codex says: "Alice: Brown eyes"                       â”‚              â”‚
â”‚  â”‚  â””â”€ FLAG: Contradiction detected                          â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                       â”‚                                                     â”‚
â”‚                       â–¼                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚                 USER REVIEW                               â”‚              â”‚
â”‚  â”‚  [Accept] [Edit] [Regenerate]                             â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### UX Patterns for Non-Technical Users

#### Pattern 1: The "@ Mention" System ("Twitterification" of Database Entry)

**Problem:** Opening forms to create characters kills creative flow.

**Solution:** Progressive Formalizationâ€”write first, organize later.

```
User types: "Ezra walked into the tavern..."
          â†“
User types: "@Ezra" 
          â†“
UI Popup: "Ezra not found. Create new Character? [Yes] [No]"
          â†“
Result: Skeleton entry created. User continues writing.
        Details filled in later. Zero friction.
```

**Implementation for 5D:**
- Add `@` detection in Chat Studio
- Auto-create entity stubs with just a name
- Queue for "flesh out later" in Completion Assistant

#### Pattern 2: The "Card" Metaphor (Hiding the Spreadsheet)

**Problem:** Users hate rows and columns. They love trading cards.

**Solution:** Visual card-based entity display.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [AVATAR]                           â”‚
â”‚                                     â”‚
â”‚  KIRA SHADOWBANE                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Role: Protagonist                  â”‚
â”‚  Archetype: Reluctant Hero          â”‚
â”‚  Arc: Redemption                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Completion: 78% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘         â”‚
â”‚                                     â”‚
â”‚  [Edit] [Chat] [Relationships]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Relationship Creation:**
- Instead of dropdown menus: Drag a line from "Alice" card to "Bob" card
- Label the connection: "Rivals"
- Database relationship created visually

#### Pattern 3: The "Sidecar" Context

**Problem:** Users constantly switch between writing and referencing.

**Solution:** Dynamic sidebar that follows the cursor.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                          â”‚
â”‚  MANUSCRIPT                          â”‚  CONTEXT SIDECAR                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                      â”‚                                   â”‚
â”‚  Kira drew her sword as the         â”‚  ğŸ“ AUTO-DETECTED: Kira           â”‚
â”‚  Northern War veterans surrounded   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  her. She remembered what Marcus    â”‚  Role: Protagonist                â”‚
â”‚  had taught her about...            â”‚  Weapon: Left-handed swordsman    â”‚
â”‚                                      â”‚  Ghost: Betrayal by mentor        â”‚
â”‚  [cursor here]                       â”‚                                   â”‚
â”‚                                      â”‚  ğŸ“ AUTO-DETECTED: Northern War   â”‚
â”‚                                      â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                      â”‚  Duration: 3 years                â”‚
â”‚                                      â”‚  Kira's Role: Scout               â”‚
â”‚                                      â”‚  Key Event: Siege of Thornwall    â”‚
â”‚                                      â”‚                                   â”‚
â”‚                                      â”‚  [Pin to Context] [Edit Entry]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Behavior:** As user clicks on a paragraph involving "The Northern War," the Sidebar *automatically updates* to show the Wiki entry. The user never searches; the relevant data "follows" their cursor.

---

## Updated Technical Implementation Plan

Based on these patterns, here's how to implement in 5D Character Creator:

### Immediate Implementation: @ Mention System

```typescript
// In Chat Studio input handler
const detectEntityMention = (text: string): EntityMention[] => {
  const mentionRegex = /@(\w+)/g;
  const mentions: EntityMention[] = [];
  let match;
  
  while ((match = mentionRegex.exec(text)) !== null) {
    const name = match[1];
    const existingEntity = findEntityByName(name);
    
    mentions.push({
      name,
      position: match.index,
      exists: !!existingEntity,
      entityId: existingEntity?.id,
      entityType: existingEntity?.type
    });
  }
  
  return mentions;
};

// UI Component for mention popup
interface MentionPopupProps {
  mention: EntityMention;
  onCreateNew: (type: EntityType) => void;
  onSelectExisting: (entityId: string) => void;
  onDismiss: () => void;
}
```

### Immediate Implementation: Context Sidecar

```typescript
// Auto-detect entities in current paragraph
const useContextSidecar = (currentText: string) => {
  const [detectedEntities, setDetectedEntities] = useState<Entity[]>([]);
  
  useEffect(() => {
    // Extract entity names from text using NER or keyword matching
    const entityNames = extractEntityNames(currentText);
    
    // Fetch full entity data for sidebar
    const entities = entityNames
      .map(name => findEntityByName(name))
      .filter(Boolean);
    
    setDetectedEntities(entities);
  }, [currentText]);
  
  return detectedEntities;
};
```

### Just-in-Time Context Injection

```typescript
// Context assembler for AI prompts
const assembleContext = async (
  mode: ChatMode,
  currentScene: string,
  linkedEntities: string[]
): Promise<string> => {
  // 1. Scan current scene for entity references
  const detectedNames = extractEntityNames(currentScene);
  
  // 2. Retrieve only relevant entities
  const relevantEntities = await Promise.all(
    detectedNames.map(name => fetchEntityByName(name))
  );
  
  // 3. Apply mode-specific field filtering
  const filteredEntities = relevantEntities.map(entity => 
    filterEntityByMode(entity, mode)
  );
  
  // 4. Assemble context block
  const contextBlock = `
## Active Characters
${filteredEntities.filter(e => e.type === 'character').map(formatCharacterContext).join('\n\n')}

## Active Locations
${filteredEntities.filter(e => e.type === 'location').map(formatLocationContext).join('\n\n')}

## Relevant Lore
${filteredEntities.filter(e => e.type === 'lore').map(formatLoreContext).join('\n\n')}

## Current Scene Goal
${getSceneGoalFromOutline()}
`;
  
  return contextBlock;
};
```

---

## Appendix: Research Sources

### Gemini Research (Round 1)
- Competitive analysis: Novelcrafter, Sudowrite, World Anvil, Campfire Pro
- Pain point synthesis: Novelists, Screenwriters, TTRPG creators
- Key insight: "Composite Workflows" with modular context injection

### Gemini Research (Round 2 - Implementation Patterns)
- Detailed implementation analysis of Novelcrafter, Sudowrite, LegendKeeper, Campfire
- "Writer vs. Historian" architecture pattern
- UX patterns: @ Mention, Card Metaphor, Context Sidecar
- Key insight: "Just-in-Time" context injection is the winning pattern

### Cursor Research (Technical)
- SCORE framework for dynamic state tracking
- Context Transfer Protocol (CTP) for cross-session continuity
- NER/POS tagging for semantic validation
- Voice fingerprinting methodologies

### Combined Synthesis
- This document represents the merged findings with actionable implementation plan

---

*Document Version: 1.1*
*Updated: January 2025*
*For: Thiink Media Graphics / 5D Character Creator (Nitro)*